## 6.1 자바스크립트의 런타임과 타입스크립트의 컴파일

- 소스코드의 컴파일이 완료되면 프로그램이 메모리에 적재되어 실행되는데 이 시간을 런타임이라고 한다.

- 타입스크립트는 `.ts` 확장자 파일을 찾아 컴파일 한 다음에 `.js` 확장자가 붙은 자바스크립트 파일을 만들어낸다

- 타입스크립트 컴파일러는 소스코드를 해석하여 AST를 만들고 이후 타입 확인을 거친 다음에 결과 코드를 생성한다

- 타입스크립트 컴파일러가 소스코드를 컴파일 하여 프로그램이 실행되기까지의 과정:

1. 타입스크립트 소스코드를 타입스크립트 AST로 만든다 (tsc)

2. 타입 검사기가 AST를 확인하여 타입을 확인한다 (tsc) -> 코드 검사기로서의 타입스크립트 컴파일러

3. 타입스크립트 AST를 자바스크립트 소스로 변환한다 (tsc) -> 코드 변환기로서의 타입스크립트 컴파일러

4. 자바스크립트 소스코드를 자바스크립트 AST로 만든다 (런타임)

5. AST가 바이트 코드로 변환된다 (런타임)

6. 런타임에서바이트 코드가 평가(evaluate)되어 프로그램이 실행된다 (런타임)

> AST(Abstract Syntax Tree) <br/>
> 컴파일러가 소스코드를 해석하는 과정에서 생성된 데이터 구조다. 컴파일러는 어휘적 분석(exical analysis)와 구문 분석(syntax analysis)를 통해 소스코드를 노드 단위의 트리 구조로 구성한다

### 코드 변환기로서의 타입스크립트 컴파일러

- 타입스크립트 컴파일러는 타입스크립트 코드를 런타임 환경에서 동작할 수 있도록 구버전의 자바스크립트로 트랜스파일 한다 (tsconfig의 target 옵션)

- 타입스크립트 컴파일러는 타입 검사 후 코드를 변환하는데 이 때 타입 오류가 있더라도 컴파일을 진행한다

- 타입 검사와 타입스크립트 코드가 자바스크립트 코드로 변환되는 과정은 독립적으로 동작하기 때문

### 타입스크립트와 바벨

- 실제 개발 환경에서는 TypeScript와 Babel이 함께 사용되는 경우가 매우 많다.

- TypeScript의 역할:

- 타입 검사를 수행하고, 타입 구문을 제거하는 1차 변환.

- Babel의 역할:

  - 타입스크립트가 생성한 (또는 타입 구문이 제거된) 최신 JavaScript 코드를 가져와, 설정된 targets에 맞춰 구형 브라우저에서 실행될 수 있는 더욱 하위 버전의 JavaScript로 최종 변환

- 예를 들어, TypeScript는 `target: "es2019"`로 설정하여 최신 JS 문법을 유지한 채 타입 검사만 수행하고, Babel은 @babel/preset-env를 통해 `targets: "ie 11"`과 같이 설정하여 실제 런타임 환경에 맞는 최적화된 JS 코드를 생성하는 방식

## 6.2 타입스크립트 컴파잉ㄹ러의 구조

타입스크립트 컴파일러는 다섯 단계를 거쳐 타입 검사와 자바스크립트 소스 변환을 진행

1. 스캐너: .ts 토큰화

2. 파서: 토큰 기반 AST 생성

3. 바인더: AST 노드 기반 심볼 생성

4. 체커: AST + 심볼 기반 타입 검사

5. 이미터: AST + 코드 검사 기반 .js 생성

### 1. 스캐너

- 소스코드를 작은 단위로 나누어 의미있는 토큰으로 변환하는 작업

### 2. 파서

- 토큰 정보를 이용하여 AST를 생성

- [Typescript AST Viewer](https://ts-ast-viewer.com/#)

### 3. 바인더: AST 노드 기반 심볼 생성

- 체커에서 탗입 검사를 할 수 있도록 기반 마련

- 타입 검사를 위한 심볼이라는 데이터 구조 생성

### 4. 체커: AST + 심볼 기반 타입 검사

- 파서가 생성한 AST와 바인더가 생성한 심볼을 활용하여 타입 검사를 수행

### 5. 이미터: AST + 코드 검사 기반 .js 생성

- 타입스크립트 소스 파일을 변환하는 역할

- 즉, 타입스크립트 소스를 자바스크립트 파일과 타입 선언 파일(d.ts)로 생성한다
